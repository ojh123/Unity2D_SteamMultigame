# Unity2D_SteamMultigame


## 1. 프로젝트 개요
+ 프로젝트명:
+ 플랫폼: PC 스팀
+ 장르: 2인 턴제 대결 게임
+ 개발 기간:
+ 사용 엔진: Unity_2022.3.60f1
+ 네트워크 : Mirror + Steamworks.NET
+ 개발 인원: 1인 개발

## 2. 게임 설명
  + 이 게임은 **2인의 플레이어**가 **숨겨진 위치**에서 **턴마다 공격을 수행**하고 움직이며, **심리전과 추리**를 통해 **상대방을 찾아 처치**하는 **전략적 대전 게임**입니다.

  + **게임 방법**:
     타일 기반 맵에서 **상대방의 위치**를 유추

     **타일 파괴**를 통해 간접적으로 상대의 존재를 확인

     아이템과 추리를 통해 **상대를 처치**

## 3. 주요 시스템 및 기능 설명
+ **네트워크 매니저** (CustomNetworkManager.cs)
  - **Mirror** 기반의 **네트워크 연결**을 설정하고, 플레이어들을 관리합니다.

+ **Steam 로비** (SteamLobby.cs)
  - **Steamworks.NET**을 이용한 **P2P 매치메이킹** 시스템.
  - 방 생성 / 참가 / 나가기 / 방 정보 동기화 처리.
  - **RoomListItem을 생성**하여 유저에게 **방 목록을 UI**로 제공.
  - **Steam Lobby** 데이터를 **Mirror에 전달**함으로써 연동 완료.

+ **아이템**
  - **ItemSpawner.cs**: 맵에 **아이템**을 **랜덤으로 생성**함.
  - **Item.cs**: 아이템의 ID, 이름, 설명, 스프라이트 등 정의.
  - **ItemDatabase.cs**: **아이템 종류**들을 **관리**.
  - **ItemPickup.cs**: 플레이어가 아이템을 **획득**할 때 **효과 발동을 처리**.
  - **ItemEffect.cs**: 다양한 **아이템 효과**가 **인터페이스(IItemEffect) 기반으로 구현**됨.

+ **셀(타일)**
  - **CellController.cs**: 각 셀의 **파괴 여부**, **플레이어 은닉** 여부 관리
  - 클릭 시 **턴 상태**에 따라 **스폰/이동/공격** 처리
  - **셀 파괴** 시 **상대 및 아이템 위치 노출**, **이펙트 출력** 등 동기화 처리.

+ **플레이어**
  - 플레이어 이동, 상태(이동, 공격, 피격, 사망), 애니메이션 처리.
  - **Mirro**r에서 **상태 동기화**를 통해 멀티플레이어 환경 구성.

+ **UI**
  - **RoomListItem.cs**: **Steam Lobby**의 **각 방 정보**를 **UI로 표시**.
  - ![image](https://github.com/user-attachments/assets/627d46f2-ade7-445b-b2d8-207d1fd75164)
  - **PlayerSlot.cs** : **Steam 유저**의 **정보를 UI**로 표시(닉네임, 프로필 사진).
  - ![image](https://github.com/user-attachments/assets/970b0458-7324-46e7-81e5-c53409cebdc2)

    
## 4. 기술 문서
 https://docs.google.com/presentation/d/1p8HLOtRiHHoiiGIYJMOrIhoHaxApWBR2cliikdRgvl4/edit?slide=id.p#slide=id.p

## 5. 구현 중 겪은 문제와 해결 방법
+ **플레이어 상태**와 **애니메이션이** **다른 클라이언트**에서 **갱신**되지 않는 문제
  - **문제** : **이동과 공격** 같은 **플레이어의 행동과 상태** 그리고 **애니메이션**이 **상대방 클라이언트**에서 동기화되지 않음.
    
  - **해결 방법** : **Mirror의 SyncVar 및 Command, ClientRpc, TargetRpc** 등을 사용해 **상태값(이동 여부, 공격 상태 등**)을 **서버에서 클라이언트**로 **동기화**. **애니메이션은** **Mirror의 Network Animator 컴포넌트**를 사용해 **애니메이션이 동기화**되도록 구현했습니다.

+ **플레이어 이동 시 짧은 시간 노출 문제**
  - **문제** : **플레이어**는 **숨을 수 있는 칸** 위에 있어 **상대방에게 안보여야** 함. 하지만 **플레이어**가 **칸**에서 **다른 칸**으로 **이동**하는 **짧은 순간** 동안 **플레이어**가 **상대방**에게 **노출**됨.
    
  - **문제 원인** : 초기에는 **OnTriggerEnter2D와 OnTriggerExit2D** 사용하여 **플레이어의 가시성**을 **제어**했습니다.
  - 그러나 이 **콜백 함수**들은 **물리 업데이트** 이후에 **발생**하거나, **객체가 이동 후 충돌 감지** 로직이 발동 되어서 **한 프레임** **늦게 발동**이 되어서 **플레이어**가 **상대방**에게 **노출**되는 현상이 나타났습니다.
    
  - **해결 방법** :  **Mirror의 SyncVar Hook** 기능을 활용하여 문제를 해결했습니다.
    **플레이어 스크립트**(**Player.cs**)에 있는 **isTeleporting이라는 SyncVar 변수**를 도입하여 이 **SyncVar 변수에 Hook 함수**(IsTeleporting)를 연결하여,
    **isTeleporting 변수의 값**이 **변경되는 즉시** 특정 **로직이 실행**되도록 만들었습니다.
    
   - **이동 시작 시**: **isTeleporting** 값이 **true**로 바뀌면, **Hook 함수**에서 **해당 플레이어**의 **스프라이트**를 **모든 클라이언트**에게 **숨기도록 처리**하여 **움직이는 순간**부터 **숨김처리**를 했습니다.

   - **이동 완료 시**: **isTeleporting** 값이 **false**로 바뀌면, **Hook 함수**에서 **플레이어**가 **위치한 셀**의 **파괴 여부**를 **확인 후** **숨거나 보이도록** 설정했습니다.


## 6. 학습 및 성과
+ **Mirror 네트워크** 구조 이해
  - SyncVar, Command, ClientRpc, TargetRpc의 동작 방식과 멀티플레이어 구조의 전체 흐름을 이해하고, 서버/클라이언트 간의 역할 분담을 이해했습니다.
 
+ **Steamworks.NET** 구조 이해
  - **Steam Lobby 시스템**의 생성, 참가, 매치메이킹, 유저 정보 처리 등 **Steamworks.NET의 API** 활용법을 익히고, 이를 **Mirror와 연결**해 **스팀 멀티플레이** 게임을 만들었습니다.
    
+ **인터페이스** 기반 **설계 능력** 향상
  - **아이템 시스템**을 **IItemEffect 인터페이스 기반**으로 설계하여, **새로운 아이템 효과**를 **손쉽게 추가** 가능하게 **확장성과 유지보수성**을 확보했습니다.

+ **문제 해결 중심**의 **디버깅** 경험
  - **Steam Lobby**와 **Mirror** 세션 연동, **UI 비동기 문제,플레이어 상태 동기화** 등 **멀티플레이 환경**에서 발생하는 문제들을 실시간 **디버깅**과 **구조 개선**을 통해 해결했습니다.


## 7. 스크린샷 및 영상
